<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Write-Off Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --clarity-orange: #ef8607; /* Correct Clarity orange */
    }
    .bg-clarity-orange {
      background-color: var(--clarity-orange);
    }
    .hover\:bg-clarity-orange-dark:hover {
      background-color: #d67605; /* Slightly darker hover color */
    }
    .text-clarity-orange {
      color: var(--clarity-orange);
    }
    .border-clarity-orange {
      border-color: var(--clarity-orange);
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="flex">
    <!-- SIDEBAR -->
    <aside class="w-64 bg-gray-900 text-white min-h-screen">
      <div class="p-4 text-lg font-bold bg-clarity-orange">Clarity Dashboard</div>
      <nav class="mt-4">
        <a href="#" class="block py-2 px-4 hover:bg-gray-700">Overview</a>
        <a href="#" class="block py-2 px-4 bg-gray-700">Write-Offs</a>
        <a href="#" class="block py-2 px-4 hover:bg-gray-700">Reports</a>
        <a href="#" class="block py-2 px-4 hover:bg-gray-700">Settings</a>
      </nav>
      <div class="absolute bottom-4 left-4 text-xs text-gray-400">Â© 2025 Clarity</div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-6">
      <h1 class="text-2xl font-bold mb-6">Write-Off Dashboard</h1>

      <!-- DATE SELECTOR + LOAD BUTTON -->
      <div class="flex items-end gap-4 mb-6">
        <div>
          <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
          <input type="date" id="startDate" class="mt-1 block w-48 border border-gray-300 rounded-md shadow-sm p-2">
        </div>
        <div>
          <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
          <input type="date" id="endDate" class="mt-1 block w-48 border border-gray-300 rounded-md shadow-sm p-2">
        </div>
        <button id="loadBtn"
          class="bg-clarity-orange hover:bg-clarity-orange-dark text-white px-4 py-2 rounded-md">
          Load Write-Offs
        </button>
      </div>

      <!-- TOTAL + EXPORT -->
      <div class="flex items-center justify-between mb-4">
        <div class="bg-white border rounded-lg shadow-sm p-4">
          <p class="text-gray-500 text-sm">TOTAL AMOUNT</p>
          <p id="totalAmount" class="text-2xl font-bold">$0.00</p>
        </div>
        <button id="exportBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">
          Export CSV
        </button>
      </div>

      <!-- TABLE -->
      <div class="overflow-x-auto bg-white shadow rounded-lg">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 border-b">
            <tr>
              <th class="py-2 px-4 text-left">Customer ID</th>
              <th class="py-2 px-4 text-left">Customer Name</th>
              <th class="py-2 px-4 text-left">Write-Off ID</th>
              <th class="py-2 px-4 text-left">Date</th>
              <th class="py-2 px-4 text-right">Total</th>
              <th class="py-2 px-4 text-center">Invoices</th>
            </tr>
          </thead>
          <tbody id="writeoffTable"></tbody>
        </table>
      </div>
    </main>
  </div>

  <script>
    // --- Fake Data ---
    const fakeWriteoffs = [
      {
        id: "WO-10001",
        customerId: "125864",
        customerName: "Demo Client A",
        date: "2025-09-01",
        total: 99.99,
        invoices: [
          { id: "INV-001", date: "2025-08-15", description: "VoIP Adjust", amount: 59.99 },
          { id: "INV-002", date: "2025-08-20", description: "Support Credit", amount: 40.00 }
        ]
      },
      {
        id: "WO-10002",
        customerId: "125937",
        customerName: "Demo Client B",
        date: "2025-09-05",
        total: 45.00,
        invoices: [
          { id: "INV-003", date: "2025-08-25", description: "Incorrect Fee", amount: 45.00 }
        ]
      }
    ];

    const tableBody = document.getElementById("writeoffTable");
    const totalAmountEl = document.getElementById("totalAmount");

    function renderTable() {
      tableBody.innerHTML = "";
      let grandTotal = 0;

      fakeWriteoffs.forEach(writeoff => {
        grandTotal += writeoff.total;

        // Main Row
        const row = document.createElement("tr");
        row.className = "border-b hover:bg-gray-50";
        row.innerHTML = `
          <td class="py-2 px-4">${writeoff.customerId}</td>
          <td class="py-2 px-4">${writeoff.customerName}</td>
          <td class="py-2 px-4">${writeoff.id}</td>
          <td class="py-2 px-4">${writeoff.date}</td>
          <td class="py-2 px-4 text-right">$${writeoff.total.toFixed(2)}</td>
          <td class="py-2 px-4 text-center">
            <button class="toggle-btn text-clarity-orange underline" data-id="${writeoff.id}">View</button>
          </td>
        `;
        tableBody.appendChild(row);

        // Hidden Invoice Row
        const invoiceRow = document.createElement("tr");
        invoiceRow.className = "hidden bg-gray-50";
        invoiceRow.setAttribute("data-parent", writeoff.id);

        let invoiceHTML = `
          <td colspan="6" class="p-4">
            <table class="w-full text-sm border">
              <thead>
                <tr class="bg-gray-100">
                  <th class="py-2 px-4 text-left">Invoice ID</th>
                  <th class="py-2 px-4 text-left">Date</th>
                  <th class="py-2 px-4 text-left">Description</th>
                  <th class="py-2 px-4 text-right">Amount</th>
                </tr>
              </thead>
              <tbody>
        `;

        writeoff.invoices.forEach(inv => {
          invoiceHTML += `
            <tr class="border-t">
              <td class="py-2 px-4">${inv.id}</td>
              <td class="py-2 px-4">${inv.date}</td>
              <td class="py-2 px-4">${inv.description}</td>
              <td class="py-2 px-4 text-right">$${inv.amount.toFixed(2)}</td>
            </tr>
          `;
        });

        invoiceHTML += "</tbody></table></td>";
        invoiceRow.innerHTML = invoiceHTML;
        tableBody.appendChild(invoiceRow);
      });

      totalAmountEl.textContent = `$${grandTotal.toFixed(2)}`;

      // Toggle logic
      document.querySelectorAll(".toggle-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const parentId = btn.getAttribute("data-id");
          const invoiceRow = document.querySelector(`[data-parent="${parentId}"]`);
          invoiceRow.classList.toggle("hidden");
        });
      });
    }

    // Export CSV
    document.getElementById("exportBtn").addEventListener("click", () => {
      let csv = "Customer ID,Customer Name,Write-Off ID,Date,Total\n";
      fakeWriteoffs.forEach(w => {
        csv += `${w.customerId},${w.customerName},${w.id},${w.date},${w.total.toFixed(2)}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "writeoffs.csv";
      link.click();
    });

    // Initial render
    document.getElementById("loadBtn").addEventListener("click", renderTable);
    renderTable();
  </script>
</body>
</html>
